# 八字系統終極架構自檢與修正報告

**案例**：男，1983年8月25日14:55，台灣台南市 (120.227°E, 22.9997°N)

**標準答案**：癸亥 庚申 乙酉 癸未｜杀重身轻｜用神水、喜神木、忌神金土｜起運5歲10個月｜乙卯大運大吉

---

## 階段一：數據輸入與四柱排盤自檢

| 檢查項 | 預期 | 修正後 |
|--------|------|--------|
| 真太陽時 | ≈14:55 | 台南 120.227°E 與東八區幾乎無差，校正後≈14:55 ✓ |
| 年柱 | 癸亥 | `calculateYearPillar` 以立春為界，有 SolarTermCalculator 時用節氣精確時刻 ✓ |
| 月柱 | 庚申 | 五虎遁已修正：戊癸之年甲寅起 → 癸年申月=庚申（非辛酉）✓ |
| 日柱 | 乙酉 | 公式計算 ✓ |
| 時柱 | 癸未 | 乙日未時，五鼠遁乙庚丙作初 → 癸未 ✓ |

**結論**：四柱排盤與標準答案一致。

---

## 階段二：格局與日主旺衰定性

| 檢查項 | 邏輯 |
|--------|------|
| 最強五行 | 申月金旺、地支申酉半會金局、天干庚透 → **金（官殺）最強** |
| 日主狀態 | 乙木申月絕、根弱（亥中甲被申害、未中乙被酉克）、得生（双癸亥）→ **身弱** |
| 格局 | 金旺克木 → **杀重身轻** |

**修正**：`shaZhongShenQing` 優先於從格判斷；`analyzePattern` 正確輸出「殺重身輕」。

---

## 階段三：喜用神邏輯

**決策樹（杀重身轻）**：
- 第一優先：印星（水）化殺生身 → **用神**
- 第二優先：比劫（木）助身 → **喜神**
- 第三考慮：食傷（火）制殺但泄身 → **闲神**
- 忌神：金（官殺）、土（財生金克水）

**修正**：
1. `calculateFavorableElements` 中 `shaZhongShenQing` 分支置於 `isCong` 之前，確保金、土為忌神，絕不標為喜用。
2. `calculateElementStrength` 中增加「有印化殺不取從格」：當印星(生我)分數≥官殺(克我)之半時，不判為從格，保留殺重身輕路徑。

---

## 階段四：五行百分比

**計算模型**：
- 天干每透計 1
- 地支藏干：本氣 1.0、中氣 0.6、餘氣 0.3
- 月令旺衰係數：申月 金旺 1.2、水相 1.1、土休 1.0、火囚 0.8、木死 0.6

**癸亥庚申乙酉癸未（申月）**：
- 金 ≈ 34%，水 ≈ 38%，木 ≈ 11%，火 ≈ 5%，土 ≈ 12%
- 金、水為前兩強，符合「杀重」定性

---

## 階段五：大運排盤與吉凶

| 檢查項 | 修正 |
|--------|------|
| 順逆 | 癸年陰干、男命 → 逆行 ✓ |
| 起運 | 立秋 1983-08-08 04:42 至 08-25 14:55 ≈ 17.43 天 ÷ 3 ≈ 5 歲 10 個月 |
| 節氣 | 1983 立秋 UTC 已修正為 20:42 Aug 7（= 04:42 Aug 8 台灣） |
| 序列 | 己未→戊午→丁巳→丙辰→乙卯→甲寅→癸丑→壬子 ✓ |
| 乙卯吉凶 | `_tagDayunWithFavorable` 判為喜用神大運（大吉）；卯酉冲日支忌神酉，加強吉利 |
| 顯示 | `renderDayun` 優先使用 `f.fortuneLevel`，`quality-mapper` 大吉→大優 |

---

## 修正檔案清單

- `js/bazi-system.js`：五虎遁、年柱立春、殺重身輕優先、卯酉冲註解
- `js/main.js`：`renderDayun` 使用 `fortuneLevel`
- `js/quality-mapper.js`：大吉→大優
- `js/solar-terms-data.js`：1983 立秋 UTC 修正
