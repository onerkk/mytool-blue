/**
 * 手機版結果分析頁面 UI 修正（與 responsive.css / main.css 同步更新）
 * - 頂部按鈕不爆版、步驟間距、大運流年水平捲動、touch-action: pan-y 不鎖死垂直捲動
 * - 文字容器接近滿版，clamp 與 safe-area、Flex 填滿父層寬度
 * - 更新時請同步檢查 responsive.css @media (max-width: 768px)/(480px) 與本檔
 */

@media (max-width: 768px) {
    /* 1) 頂部按鈕不溢出：max-width: 100vw、box-sizing、flex 1 1 0%（與 responsive 同步） */
    .nav-container {
        width: 100% !important;
        max-width: 100vw !important;
        padding: 10px !important;
        box-sizing: border-box !important;
    }
    .nav-shop-buttons {
        width: 100%;
        max-width: 100vw !important;
        padding: 0 !important;
        box-sizing: border-box !important;
        display: flex !important;
        gap: 8px !important;
        min-width: 0;
    }
    .nav-shop-buttons .shop-btn {
        flex: 1 1 0% !important;
        min-width: 0 !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
        font-size: clamp(12px, 3vw, 16px) !important;
    }
    .nav-shop-buttons .shop-btn i {
        flex-shrink: 0;
    }
    
    /* 捲動：與 responsive 一致，垂直滑動不鎖死 */
    #page-scroll.page-scroll {
        touch-action: pan-y !important;
        -webkit-overflow-scrolling: touch !important;
    }
    
    /* 2) 步驟條與個人資料輸入之間：強制 1rem，消除巨大空白 */
    .progress-container {
        margin: 1rem 0 !important;
    }
    #input-section.section.active,
    #input-section {
        margin-top: 0 !important;
        margin: 1rem 0 !important;
    }
    
    /* ===== 統一主要容器寬度（與資料輸入區一致） ===== */
    .main-container {
        padding: 0.5rem !important; /* 10px 等級，左右一致 */
        width: 100% !important;
        max-width: 100% !important;
        box-sizing: border-box !important;
    }
    
    /* 區塊間距：clamp 與 responsive 同步，避免大空白 */
    .section {
        padding: clamp(12px, 2.5vw, 18px) !important;
        margin-bottom: clamp(12px, 2.5vw, 18px) !important;
        width: 100% !important;
        max-width: 100% !important;
        box-sizing: border-box !important;
    }
    
    /* ===== 分析結果區：與 Bazi 同寬同 padding（滿版，safe-area 與 responsive 同步） ===== */
    #result-section {
        width: 100% !important;
        max-width: none !important;
        min-width: 0 !important;
        box-sizing: border-box !important;
        margin-left: 0 !important;
        margin-right: 0 !important;
        padding: clamp(12px, 2.5vw, 18px) !important;
        padding-bottom: max(150px, calc(150px + env(safe-area-inset-bottom, 0))) !important;
        overflow-x: auto !important;
        overflow-y: visible !important;
        -webkit-overflow-scrolling: touch !important;
    }
    
    /* 內層與 Bazi 的 bazi-container 一致：無左右 padding，不限制寬度 */
    #result-section .bazi-container,
    #result-section .result-overview,
    #result-section .dimension-analysis,
    #result-section .dimension-content,
    #result-section .dimension-pane,
    #result-section .bazi-result,
    #result-section .analysis-grid-container {
        width: 100% !important;
        max-width: none !important;
        min-width: 0 !important;
        box-sizing: border-box !important;
        padding-left: 0 !important;
        padding-right: 0 !important;
    }
    
    #result-section .bazi-container {
        overflow-x: visible !important;
        overflow-y: visible !important;
    }
    
    /* ===== 結果概覽：區塊全寬，左右無額外留白（與 Bazi 內容對齊） ===== */
    #result-section .result-overview {
        display: block !important;
        width: 100% !important;
        max-width: none !important;
        box-sizing: border-box !important;
        margin-bottom: 1rem !important;
        gap: 0 !important;
    }
    
    #result-section .result-overview > .overview-card,
    #result-section .result-overview > .probability-meter {
        display: block !important;
        width: 100% !important;
        max-width: none !important;
        flex: 1 1 100% !important;
        box-sizing: border-box !important;
        margin-right: 0 !important;
        margin-bottom: 0.75rem !important;
        padding: 0.75rem 0 !important; /* 左右 0，與 Bazi 內容同寬 */
    }
    /* 本次輸入：緊湊單行，手機版同寬 */
    #result-section .input-summary-compact {
        width: 100% !important;
        padding: 0.4rem 0.6rem !important;
        font-size: 0.75rem !important;
    }
    
    #result-section .overview-card,
    #result-section .probability-meter {
        width: 100% !important;
        max-width: none !important;
        box-sizing: border-box !important;
    }
    
    /* ===== 文字區塊：寬度 100%，可換行，不限制 max-width ===== */
    #result-section .question-display,
    #result-section .direct-answer {
        width: 100% !important;
        max-width: 100% !important;
        box-sizing: border-box !important;
        padding: 0.5rem !important; /* 約 8px */
        word-wrap: break-word !important;
        overflow-wrap: break-word !important;
        white-space: normal !important;
        flex: 1 1 100% !important;
    }
    
    #result-section .answer-text,
    #result-section .meter-header,
    #result-section .meter-labels {
        width: 100% !important;
        max-width: 100% !important;
        word-wrap: break-word !important;
        overflow-wrap: break-word !important;
        white-space: normal !important;
    }
    
    /* ===== 四維度分析區：左右無留白，與 Bazi 同寬 ===== */
    #result-section .dimension-analysis {
        width: 100% !important;
        max-width: none !important;
        box-sizing: border-box !important;
        padding: 0.75rem 0 !important; /* 左右 0 */
        margin-bottom: 1rem !important;
    }
    
    #result-section .dimension-tabs {
        width: 100% !important;
        max-width: none !important;
        padding-left: 0 !important;
        padding-right: 0 !important;
        padding-bottom: 0.5rem !important;
        margin-bottom: 0.75rem !important;
        overflow-x: auto !important;
        -webkit-overflow-scrolling: touch !important;
        gap: 0.35rem !important;
    }
    
    #result-section .dimension-tab {
        flex-shrink: 0 !important;
        padding: 0.4rem 0.6rem !important; /* 略小 */
        font-size: 0.8rem !important;
    }
    
    #result-section .dimension-content,
    #result-section .dimension-pane,
    #result-section .bazi-result {
        width: 100% !important;
        max-width: 100% !important;
        box-sizing: border-box !important;
        padding: 0.5rem 0 !important;
        padding-right: 0 !important;
        overflow-x: auto !important;
        -webkit-overflow-scrolling: touch !important;
    }
    
    /* ===== 分析卡片與文字內容：滿版、flex 填滿 ===== */
    #result-section .analysis-grid-container,
    #result-section .analysis-card {
        width: 100% !important;
        max-width: 100% !important;
        box-sizing: border-box !important;
    }
    
    #result-section .analysis-card {
        padding: 0.75rem 0 !important; /* 左右 0，與 Bazi 同寬 */
    }
    
    #result-section .text-content,
    #result-section .tag-container,
    #result-section #ui-shensha-content {
        width: 100% !important;
        max-width: 100% !important;
        flex: 1 1 100% !important;
        box-sizing: border-box !important;
    }
    
    /* 避免任何子元素固定 px 寬度限制 */
    #result-section * {
        box-sizing: border-box !important;
    }

    /* ===== 詳細命理分析（含桃花婚姻）手機版易讀 ===== */
    #result-section .bazi-advanced-analysis,
    #result-section .advanced-analysis-section {
        width: 100% !important;
        max-width: 100% !important;
        padding: 0.75rem 0 !important;
        margin-top: 1rem !important;
    }
    #result-section .advanced-analysis-section h3 {
        font-size: 1.1rem !important;
        margin-bottom: 1rem !important;
        line-height: 1.4 !important;
    }
    #result-section .advanced-analysis-section .analysis-group {
        display: block !important;
        width: 100% !important;
        margin-bottom: 1.25rem !important;
    }
    #result-section .advanced-analysis-section .analysis-group[style*="grid-template-columns: repeat(2, 1fr)"] {
        display: flex !important;
        flex-direction: column !important;
        gap: 1rem !important;
    }
    #result-section .advanced-analysis-section .ten-gods-grid {
        grid-template-columns: repeat(4, 1fr) !important;
        gap: 0.5rem !important;
    }
    /* 十二長生手機同步（與十神分析四柱網格一致） */
    #result-section .advanced-analysis-section .longevity-grid {
        grid-template-columns: repeat(4, 1fr) !important;
        gap: 0.5rem !important;
    }
    #result-section .advanced-analysis-section .longevity-item {
        padding: 0.75rem 0.5rem !important;
        min-height: 3.5rem !important;
    }
    #result-section .advanced-analysis-section .longevity-pillar-name {
        font-size: 0.85rem !important;
    }
    #result-section .advanced-analysis-section .longevity-value {
        font-size: 0.95rem !important;
    }
    #result-section .advanced-analysis-section .analysis-card,
    #result-section .advanced-analysis-section .wealth-analysis,
    #result-section .advanced-analysis-section .relationship-analysis,
    #result-section .advanced-analysis-section .personality-analysis,
    #result-section .advanced-analysis-section .career-analysis {
        width: 100% !important;
        max-width: 100% !important;
    }
    #result-section .advanced-analysis-section .analysis-card {
        padding: 1rem !important;
        margin-bottom: 1rem !important;
    }
    #result-section .advanced-analysis-section .analysis-card h4 {
        font-size: 1rem !important;
        margin-bottom: 0.75rem !important;
    }
    #result-section .advanced-analysis-section p,
    #result-section .advanced-analysis-section .personality-analysis p,
    #result-section .advanced-analysis-section .career-analysis p,
    #result-section .advanced-analysis-section .wealth-analysis div,
    #result-section .advanced-analysis-section .relationship-analysis div,
    #result-section .advanced-analysis-section .relationship-analysis p {
        line-height: 1.65 !important;
        margin-bottom: 0.5rem !important;
        word-wrap: break-word !important;
        overflow-wrap: break-word !important;
    }
    #result-section .advanced-analysis-section .traits .strengths,
    #result-section .advanced-analysis-section .traits .weaknesses {
        padding: 0.6rem !important;
        margin-bottom: 0.5rem !important;
        line-height: 1.5 !important;
    }
    
    /* 十神與藏干：全寬區塊，四柱均分，不橫向滑動、不 min-width 限制 */
    #result-section .analysis-card-tengods {
        overflow-x: visible !important;
    }
    
    #result-section .analysis-card-tengods .gods-detail-grid {
        min-width: 0 !important;
        width: 100% !important;
        max-width: 100% !important;
    }
    
    /* 結果區底部留白（含 iOS 安全區）：與 responsive 一致，已在上方 #result-section 統一設定 */
    
    /* 綜合結論、推薦區等底部區塊也留白 */
    #result-section .final-conclusion,
    #result-section .master-summary,
    #result-section .product-recommendation-card,
    #result-section .lucky-item-recommendation-card {
        margin-bottom: 0.5rem !important;
    }

    /* 5) 大運流年：解除捲動鎖死—height: auto、touch-action: pan-y 讓垂直滑動交給頁面 */
    .dayun-container,
    .fortune-cycles-container {
        overflow-x: auto !important;
        overflow-y: visible !important;
        height: auto !important;
        touch-action: pan-y !important;
    }
    .dayun-timeline {
        overflow-x: auto !important;
        overflow-y: visible !important;
        height: auto !important;
        touch-action: pan-y !important;
    }

    /* 本系統說明：預設一行、詳細展開收合（與 responsive 同步） */
    .hint-system-note {
        font-size: 0.9rem;
        line-height: 1.5;
    }
    .hint-system-short {
        display: block;
    }
    .hint-system-details {
        margin-top: 0.35rem;
    }
    .hint-system-toggle {
        cursor: pointer;
        color: var(--gold-primary, #D4AF37);
        font-size: 0.85rem;
        list-style: none;
    }
    .hint-system-toggle::-webkit-details-marker { display: none; }
    .hint-system-details p {
        margin: 0.35rem 0 0;
        font-size: 0.85rem;
        opacity: 0.9;
    }

    /* ===== 大運流年手機同步（與 main.css .dayun-quality / .dayun-fortune-type 一致，未來更新請同步） ===== */
    .dayun-quality--excellent,
    .dayun-quality--excellent-bright {
        color: #fff !important;
        background: rgba(56, 142, 60, 0.85) !important;
        border: 1px solid rgba(76, 175, 80, 0.6) !important;
    }
    .dayun-quality--good {
        color: #fff !important;
        background: rgba(67, 160, 71, 0.8) !important;
        border: 1px solid rgba(139, 195, 74, 0.6) !important;
    }
    .dayun-quality--neutral-good {
        color: #1a1a1a !important;
        background: rgba(205, 220, 57, 0.9) !important;
        border: 1px solid rgba(156, 204, 101, 0.6) !important;
    }
    .dayun-quality--neutral,
    .dayun-quality--average {
        color: #1a1a1a !important;
        background: rgba(255, 193, 7, 0.85) !important;
        border: 1px solid rgba(255, 152, 0, 0.6) !important;
    }
    .dayun-quality--warning {
        color: #1a1a1a !important;
        background: rgba(255, 235, 59, 0.9) !important;
        border: 1px solid rgba(255, 193, 7, 0.6) !important;
    }
    .dayun-quality--bad,
    .dayun-quality--poor {
        color: #fff !important;
        background: rgba(198, 40, 40, 0.85) !important;
        border: 1px solid rgba(244, 67, 54, 0.6) !important;
    }
    .dayun-quality--danger {
        color: #fff !important;
        background: rgba(183, 28, 28, 0.9) !important;
        border: 1px solid rgba(211, 47, 47, 0.6) !important;
    }
    .dayun-fortune-type--fav {
        color: #0d3d0d !important;
        background: #c8e6c9 !important;
        border: 1px solid #81c784 !important;
    }
    .dayun-fortune-type--unfav {
        color: #fff !important;
        background: #b71c1c !important;
        border: 1px solid #c62828 !important;
    }
    .dayun-fortune-type--mixed {
        color: #1a1a1a !important;
        background: #fff9c4 !important;
        border: 1px solid #ffca28 !important;
    }
}

/* 小螢幕 480px：與 main.css / responsive.css 同步（蝦皮/賣貨便左右排、區塊間距） */
@media (max-width: 480px) {
    .section {
        padding: clamp(12px, 2.5vw, 18px) !important;
        margin-bottom: clamp(12px, 2.5vw, 18px) !important;
    }
    #result-section {
        padding: clamp(12px, 2.5vw, 18px) !important;
        padding-bottom: max(100px, calc(80px + env(safe-area-inset-bottom, 0))) !important;
    }
    .nav-shop-buttons {
        flex-direction: row !important;
        flex-wrap: nowrap;
        gap: 0.5rem;
    }
    .nav-shop-buttons .shop-btn {
        flex: 1 1 0;
        min-width: 0;
    }
    .recommendation-buttons {
        grid-template-columns: repeat(2, 1fr) !important;
        gap: 0.5rem;
    }
}
