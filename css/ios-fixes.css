/* iOS兼容性修復和優化 - 與手機同步、修正 iOS 排版 */

/* 單一捲動根：僅 html 捲動，body 不捲動，Chrome Android 單指才穩定 */
html {
    height: 100%;
    overflow-x: hidden;
    overflow-y: scroll;
    -webkit-text-size-adjust: 100%;
    text-size-adjust: 100%;
}

* {
    box-sizing: border-box;
}

body {
    min-height: 100%;
    min-height: 100vh;
    min-height: -webkit-fill-available;
    min-height: 100dvh;
    overflow-x: hidden;
    overflow-y: visible;
    position: relative;
    width: 100%;
    max-width: 100%;
    overscroll-behavior-y: none;
}

/* 文字不截斷／提早換行 */
input, select, textarea, .section, .progress-step, .btn, .hint-note {
    overflow-wrap: anywhere;
    word-break: break-word;
}

/* 底部安全區（iPhone 劉海／Home Indicator） */
.main-container, .section-actions, .progress-container {
    padding-bottom: env(safe-area-inset-bottom, 0);
}

/* 浮動按鈕：安全區 + 固定於視窗底部 */
.floating-buttons {
    bottom: max(15px, env(safe-area-inset-bottom, 15px)) !important;
    right: max(8px, env(safe-area-inset-right, 8px)) !important;
    left: auto !important;
    z-index: 999;
    /* iOS fixed 定位修復 */
    -webkit-transform: translateZ(0);
    transform: translateZ(0);
}
@media (max-width: 359px) {
    .floating-buttons { flex-wrap: wrap; max-width: 100px; }
}

/* iOS Safari 專用：加上 -webkit-overflow-scrolling（僅 iOS 需要） */
@supports (-webkit-touch-callout: none) {
    html {
        position: relative;
        overflow-y: auto;
        overflow-x: hidden;
        -webkit-overflow-scrolling: touch;
        height: -webkit-fill-available;
    }
    
    body {
        position: relative;
        overflow-y: visible;
        overflow-x: hidden;
        height: auto;
        min-height: 100vh;
        min-height: -webkit-fill-available;
        min-height: 100dvh;
    }
    
    /* iOS 結果區底部留白（含 Home Indicator） */
    #result-section {
        padding-bottom: max(150px, calc(150px + env(safe-area-inset-bottom, 0))) !important;
    }
    
    /* iOS 模態框安全區 */
    .modal-content,
    .modal-content-custom,
    .card-interpretation-modal .modal-content {
        padding-bottom: max(1rem, env(safe-area-inset-bottom, 1rem)) !important;
        padding-left: max(1rem, env(safe-area-inset-left, 1rem)) !important;
        padding-right: max(1rem, env(safe-area-inset-right, 1rem)) !important;
    }
}

/* 修復iOS輸入框樣式 */
input[type="text"],
input[type="number"],
input[type="date"],
input[type="time"],
input[type="email"],
input[type="tel"],
select,
textarea {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    border-radius: 8px;
    font-size: 16px; /* 防止iOS自動縮放 */
}

/* iOS按鈕點擊高亮移除 */
button,
.btn,
a {
    -webkit-tap-highlight-color: transparent;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    user-select: none;
}

/* 修復iOS滾動性能 */
.scrollable {
    -webkit-overflow-scrolling: touch;
    overflow-y: auto;
}

/* iOS 安全區域適配（劉海／圓角） */
@supports (padding: max(0px)) {
    .navbar,
    .main-container {
        padding-left: max(1rem, env(safe-area-inset-left));
        padding-right: max(1rem, env(safe-area-inset-right));
    }
    
    .navbar {
        padding-top: max(1rem, env(safe-area-inset-top));
    }
    
    /* 進度條、結果區左右安全區 */
    .progress-container,
    #result-section {
        padding-left: max(0.75rem, env(safe-area-inset-left));
        padding-right: max(0.75rem, env(safe-area-inset-right));
    }
}

/* 修復iOS上的fixed定位問題 */
.navbar {
    position: -webkit-sticky;
    position: sticky;
}

/* iOS動畫優化 - 僅應用於需要動畫的元素，避免影響滾動 */
.animated,
.tarot-card,
.btn,
.nav-link {
    -webkit-transform: translateZ(0);
    transform: translateZ(0);
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
}

/* 修復iOS上的flex布局 */
.flex-container {
    display: -webkit-flex;
    display: flex;
}

/* iOS字體渲染優化 */
body {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
}

/* 修復iOS上的陰影效果 */
.card,
.btn,
.section {
    -webkit-box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}

/* iOS觸摸反饋 */
button:active,
.btn:active {
    opacity: 0.8;
    -webkit-transform: scale(0.98);
    transform: scale(0.98);
    transition: all 0.1s ease;
}

/* 修復iOS上的transition - 僅應用於需要過渡的元素 */
.btn,
.nav-link,
.tarot-card,
.card-flip,
input,
select,
textarea {
    -webkit-transition: all 0.3s ease;
    transition: all 0.3s ease;
}

/* iOS選擇文本顏色 */
::selection {
    background-color: rgba(74, 44, 109, 0.3);
    color: inherit;
}

::-moz-selection {
    background-color: rgba(74, 44, 109, 0.3);
    color: inherit;
}
