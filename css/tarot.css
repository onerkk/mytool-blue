/* css/tarot.css - 靜月之前能量占卜儀 塔羅牌系統 v1.0 */

/* 容器設定 */
.tarot-container {
    position: relative;
    width: 100%;
    min-height: 900px;
    perspective: 1000px;
    overflow-x: hidden;
    padding-bottom: 80px;
    background: transparent !important;
}

/* 1. 洗牌區域 - 完全修正動畫遮擋文字問題 */
.shuffle-area {
    text-align: center;
    padding: 2rem 0;
    min-height: 500px;
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    z-index: 10;
}

.shuffle-instruction {
    text-align: center;
    margin-bottom: 2rem;
    color: var(--text-primary);
    width: 100%;
    padding: 0 1rem;
}

.shuffle-instruction h3 {
    color: var(--gold-primary);
    margin-bottom: 0.5rem;
    font-size: 1.8rem;
}

.shuffle-instruction p {
    color: var(--text-secondary);
    font-size: 1.1rem;
    line-height: 1.6;
    max-width: 600px;
    margin: 0 auto;
}

.deck-container {
    position: relative;
    height: 320px;
    width: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    margin-top: 20px;
    background: none !important;
    z-index: 20;
}

.tarot-deck {
    position: relative;
    width: 120px;
    height: 200px;
    background-image: url('../images/back.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    border: 2px solid var(--gold-primary);
    border-radius: 10px;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
    z-index: 30;
    cursor: pointer;
    transition: transform 0.3s ease;
    margin-bottom: 1rem;
}

/* 動畫時隱藏初始牌堆的金框 */
.shuffle-animation.active ~ .deck-container .tarot-deck,
.shuffle-animation[style*="display: block"] ~ .deck-container .tarot-deck {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
    border: none !important;
    box-shadow: none !important;
}

.tarot-deck:hover {
    transform: scale(1.05);
    box-shadow: 0 0 25px rgba(212, 175, 55, 0.5);
}

.deck-count { 
    text-align: center; 
    color: var(--gold-primary);
    display: none; /* 隱藏 78 字樣 */
}

.deck-count .count-number { 
    font-size: 3rem; 
    font-weight: bold; 
    display: block; 
    margin-bottom: 5px;
    text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
}

.deck-count .count-text { 
    font-size: 1rem;
    color: var(--text-secondary);
}

.shuffle-controls {
    margin-top: 2rem;
    display: flex;
    gap: 1rem;
    justify-content: center;
    z-index: 25;
}

.shuffle-controls .btn,
.shuffle-controls button,
#reset-shuffle,
#shuffle-btn {
    text-align: center !important;
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
}

.shuffle-controls .btn *,
.shuffle-controls button * {
    text-align: center !important;
}

/* 確保洗牌動畫區域內沒有牌堆顯示（但保留按鈕） */
.shuffle-animation .tarot-deck,
.shuffle-animation .riffle-pile::before,
.shuffle-animation .riffle-pile::after {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
    background: none !important;
    background-image: none !important;
    border: none !important;
    box-shadow: none !important;
}

/* 只在動畫顯示時隱藏初始牌堆 */
.shuffle-animation.active ~ .deck-container .tarot-deck,
.shuffle-animation[style*="display: block"] ~ .deck-container .tarot-deck {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
    border: none !important;
    box-shadow: none !important;
}

/* 確保按鈕控制區始終可見 */
.shuffle-controls,
.shuffle-controls .btn,
#shuffle-btn {
    display: flex !important;
    visibility: visible !important;
    opacity: 1 !important;
}

/* 洗牌動畫區域 - 完全修正遮擋問題 */
.shuffle-animation {
    text-align: center;
    margin: 2rem auto;
    position: relative;
    height: 300px; /* 增加高度以容納動畫 */
    display: block;
    z-index: 15;
    width: 100%;
    max-width: 800px;
    box-sizing: border-box;
    /* 確保居中 */
    left: auto;
    right: auto;
    transform: none;
}

.animation-container {
    position: relative;
    width: 100%;
    height: 200px; /* 增加高度以容納洗牌動畫 */
    margin: 0 auto 30px;
    display: block;
    overflow: visible; /* 允許動畫可見 */
    min-height: 200px;
    box-sizing: border-box;
    /* 確保居中 */
    left: auto;
    right: auto;
    transform: none;
}

/* 修正浮動卡片位置和尺寸 */
.card-floating {
    position: absolute;
    width: 70px;
    height: 105px;
    background: linear-gradient(135deg, var(--gold-primary), var(--amethyst));
    background-image: url('../images/back.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    background-color: transparent;
    border-radius: 8px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.3);
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: cardFloat 2.5s ease-in-out infinite;
    animation-delay: var(--delay);
    z-index: 16;
    border: 1px solid rgba(212, 175, 55, 0.5);
}

/* 優化的浮動動畫，限制移動範圍 */
@keyframes cardFloat {
    0%, 100% { 
        transform: translate(-50%, -50%) translateY(0) rotate(0deg);
        opacity: 0.8;
        box-shadow: 0 6px 15px rgba(0,0,0,0.3);
    }
    25% { 
        transform: translate(-50%, -50%) translateY(-15px) rotate(3deg);
        opacity: 0.9;
        box-shadow: 0 10px 20px rgba(0,0,0,0.4);
    }
    50% { 
        transform: translate(-50%, -50%) translateY(-25px) rotate(0deg);
        opacity: 1;
        box-shadow: 0 12px 25px rgba(212, 175, 55, 0.4);
    }
    75% { 
        transform: translate(-50%, -50%) translateY(-15px) rotate(-3deg);
        opacity: 0.9;
        box-shadow: 0 10px 20px rgba(0,0,0,0.4);
    }
}

/* 修正文字位置和樣式，確保不被遮擋 */
.shuffle-text {
    position: relative;
    z-index: 20; /* 提高層級確保在動畫之上 */
    margin: 15px auto 0;
    font-size: 1.2em;
    font-weight: 600;
    color: var(--gold-bright);
    text-align: center !important;
    padding: 15px 25px;
    background: rgba(0, 0, 0, 0.7);
    display: block;
    width: auto;
    max-width: 90%;
    /* 確保居中 */
    left: auto;
    right: auto;
    transform: none;
    margin-left: auto;
    margin-right: auto;
    backdrop-filter: blur(10px);
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.4);
    border: 2px solid rgba(212, 175, 55, 0.4);
    width: 85%;
    max-width: 450px;
    line-height: 1.5;
    text-shadow: 0 2px 4px rgba(0,0,0,0.5);
}

/* 移除舊的動畫樣式避免衝突 */
.riffle-pile {
    position: absolute;
    width: 120px;
    height: 200px;
    background-image: url('../images/back.jpg');
    background-size: cover;
    border-radius: 10px;
    border: 1px solid var(--gold-primary);
    box-shadow: 2px 2px 5px rgba(0,0,0,0.5);
    opacity: 0;
    pointer-events: none;
    z-index: 25;
}

@keyframes riffleLeft {
    0% { transform: translate(-80px, 0); opacity: 1; z-index: 25; }
    50% { transform: translate(0, 0); z-index: 26; } 
    100% { transform: translate(-80px, 0); opacity: 1; z-index: 25; }
}

@keyframes riffleRight {
    0% { transform: translate(80px, 0); opacity: 1; z-index: 26; }
    50% { transform: translate(0, 0); z-index: 25; }
    100% { transform: translate(80px, 0); opacity: 1; z-index: 26; }
}

/* 2. 抽牌區域 */
.draw-area {
    position: relative;
    width: 100%;
    min-height: 600px;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 1rem;
}

.draw-instruction {
    text-align: center;
    margin-bottom: 2rem;
    color: var(--text-primary);
    width: 100%;
}

.draw-instruction h3 {
    color: var(--gold-primary);
    margin-bottom: 0.5rem;
    font-size: 1.8rem;
}

.draw-instruction p {
    color: var(--text-secondary);
    font-size: 1.1rem;
    line-height: 1.6;
    max-width: 600px;
    margin: 0 auto;
}

.fan-container {
    position: relative;
    width: 100%;
    height: 400px;
    margin-top: 20px;
    display: flex;
    justify-content: center;
    background: none;
    border-radius: 0;
}

.fan-card {
    position: absolute;
    width: 80px;
    height: 140px;
    background-image: url('../images/back.jpg');
    background-size: cover;
    border-radius: 6px;
    border: 1px solid var(--gold-bright);
    box-shadow: -2px 0 5px rgba(0,0,0,0.4);
    transform-origin: center 250%; 
    transition: transform 0.3s ease, margin-top 0.3s ease;
    cursor: pointer;
    top: 50px; 
}

.fan-card:hover { 
    margin-top: -30px; 
    z-index: 200 !important; 
    box-shadow: 0 0 15px var(--gold-bright);
    transform: scale(1.05);
}

.fan-card.selected { 
    transform: translateY(-800px) scale(0.5) !important; 
    opacity: 0; 
    transition: all 0.6s ease; 
}

.draw-circle {
    position: relative;
    width: 600px;
    height: 600px;
    margin: 2rem auto;
    border: 3px dashed var(--gold-primary);
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
}

.draw-controls {
    margin-top: 2rem;
    display: flex;
    gap: 1rem;
    justify-content: center;
}

/* 3. 牌陣區域 */
.spread-area { 
    padding: 20px 10px; 
    width: 100%; 
}

.spread-instruction {
    text-align: center;
    margin-bottom: 2rem;
    color: var(--text-primary);
}

.spread-instruction h3 {
    color: var(--gold-primary);
    margin-bottom: 0.5rem;
    font-size: 1.8rem;
}

.spread-instruction p {
    color: var(--text-secondary);
    font-size: 1.1rem;
    line-height: 1.6;
    max-width: 600px;
    margin: 0 auto;
}

.celtic-cross-layout {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    grid-template-rows: repeat(4, 180px);
    gap: 10px;
    max-width: 900px;
    margin: 0 auto;
}

.pos-1 { 
    grid-area: 2 / 2 / 3 / 3; 
}

.pos-2 { 
    grid-area: 2 / 2 / 3 / 3; 
    z-index: 5; 
    pointer-events: none; 
}

.pos-2 .card-slot { 
    transform: rotate(90deg); 
    opacity: 0.95; 
    pointer-events: auto; 
}

.pos-2 .card-label { 
    transform: rotate(-90deg); 
    width: 150px; 
    left: -35px; 
    bottom: -60px; 
}

.pos-3 { 
    grid-area: 1 / 2 / 2 / 3; 
}

.pos-4 { 
    grid-area: 3 / 2 / 4 / 3; 
}

.pos-5 { 
    grid-area: 2 / 1 / 3 / 2; 
}

.pos-6 { 
    grid-area: 2 / 3 / 3 / 4; 
}

.pos-7 { 
    grid-area: 4 / 5 / 5 / 6; 
}

.pos-8 { 
    grid-area: 3 / 5 / 4 / 6; 
}

.pos-9 { 
    grid-area: 2 / 5 / 3 / 6; 
}

.pos-10 { 
    grid-area: 1 / 5 / 2 / 6; 
}

.spread-position {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
}

.position-label {
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--gold-primary);
    margin-bottom: 10px;
    text-align: center;
    text-shadow: 0 1px 3px rgba(0,0,0,0.5);
    background: rgba(0,0,0,0.5);
    padding: 5px 10px;
    border-radius: 4px;
    border: 1px solid rgba(212, 175, 55, 0.3);
}

.card-slot {
    width: 80px;
    height: 140px;
    border: 2px dashed rgba(255, 215, 0, 0.2);
    border-radius: 6px;
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: visible; 
    background: rgba(0, 0, 0, 0.2);
    transition: border-color 0.3s ease;
}

.card-slot:hover {
    border-color: rgba(255, 215, 0, 0.5);
}

/* 牌義標籤樣式 */
.card-label {
    position: absolute;
    bottom: -70px;
    left: 50%;
    transform: translateX(-50%);
    width: 130px;
    text-align: center;
    font-size: 0.9rem;
    color: var(--gold-bright);
    text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
    
    background: rgba(0,0,0,0.85);
    padding: 8px 10px;
    border-radius: 8px;
    border: 1px solid var(--gold-primary);
    box-shadow: 0 4px 12px rgba(0,0,0,0.5);
    
    opacity: 0; 
    transition: opacity 0.5s ease;
    pointer-events: none;
    z-index: 100;
    line-height: 1.4;
}

.card-label.show {
    opacity: 1;
}

/* 翻牌動畫 */
.tarot-card {
    width: 100%;
    height: 100%;
    position: relative;
    perspective: 1000px;
    cursor: pointer;
}

.card-flip {
    position: relative;
    width: 100%;
    height: 100%;
    transform-style: preserve-3d;
    transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.card-flip.flipped { 
    transform: rotateY(180deg); 
}

.card-face {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden; 
    -webkit-backface-visibility: hidden; 
    border-radius: 6px;
    overflow: hidden;
    border: 1px solid var(--gold-primary);
    box-shadow: 0 2px 8px rgba(0,0,0,0.5);
    background-color: #fff;
}

.card-face.back {
    background-image: url('../images/back.jpg');
    background-size: cover;
    transform: rotateY(0deg);
    z-index: 2; 
}

.card-face.front {
    transform: rotateY(180deg);
    z-index: 1;
}

/* 強制翻牌後正面在上 */
.card-flip.flipped .card-face.front { 
    z-index: 10 !important; 
}

.card-flip.flipped .card-face.back { 
    z-index: 0 !important; 
}

.card-face img { 
    width: 100%; 
    height: 100%; 
    object-fit: cover; 
    display: block; 
}

.spread-controls { 
    text-align: center; 
    margin-top: 50px; 
    display: flex; 
    justify-content: center; 
    gap: 20px; 
    padding-bottom: 30px; 
}

/* 牌義解釋模態框 */
.card-interpretation-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    z-index: 1000;
    overflow-y: auto;
}

.card-interpretation-modal.active {
    display: block;
}

.modal-content {
    position: relative;
    width: 90%;
    max-width: 900px;
    margin: 50px auto;
    background: var(--dark-surface);
    border-radius: var(--border-radius-lg);
    border: 2px solid var(--gold-primary);
    box-shadow: 0 0 50px rgba(212, 175, 55, 0.5);
    overflow: hidden;
}

.modal-close {
    position: absolute;
    top: 15px;
    right: 15px;
    background: none;
    border: none;
    color: var(--gold-primary);
    font-size: 2rem;
    cursor: pointer;
    z-index: 10;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.modal-close:hover {
    background: rgba(212, 175, 55, 0.2);
    transform: rotate(90deg);
}

.modal-body {
    padding: 2rem;
}

.card-display {
    display: grid;
    grid-template-columns: 1fr 2fr;
    gap: 2rem;
}

.card-image {
    display: flex;
    align-items: center;
    justify-content: center;
}

.card-image img {
    width: 100%;
    max-width: 300px;
    border-radius: 12px;
    border: 3px solid var(--gold-primary);
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
}

.card-info {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.card-info h3 {
    color: var(--gold-primary);
    font-size: 2rem;
    margin-bottom: 0.5rem;
}

.card-orientation {
    display: inline-block;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-weight: 600;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.card-orientation.upright {
    background: rgba(76, 175, 80, 0.2);
    color: #4CAF50;
    border: 1px solid rgba(76, 175, 80, 0.5);
}

.card-orientation.reversed {
    background: rgba(244, 67, 54, 0.2);
    color: #F44336;
    border: 1px solid rgba(244, 67, 54, 0.5);
}

.card-details {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    padding: 1rem;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 8px;
    border: 1px solid rgba(212, 175, 55, 0.2);
}

.card-details .detail {
    display: flex;
    flex-direction: column;
}

.card-details .detail span:first-child {
    font-weight: 600;
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 0.25rem;
}

.card-details .detail span:last-child {
    color: var(--text-primary);
    font-weight: 500;
}

.card-meaning, .card-advice {
    background: rgba(0, 0, 0, 0.3);
    padding: 1.5rem;
    border-radius: 8px;
    border-left: 4px solid var(--gold-primary);
}

.card-meaning h4, .card-advice h4 {
    color: var(--gold-primary);
    margin-bottom: 1rem;
    font-size: 1.3rem;
}

.card-meaning p, .card-advice p {
    color: var(--text-primary);
    line-height: 1.7;
    font-size: 1.1rem;
}

/* 逆位牌圖片樣式 */
.card-face.front img.reversed-card {
    transform: rotate(180deg);
}

/* 確保標籤樣式不變 */
.card-label {
    z-index: 200;
}

/* 響應式設計 - 完整版本 */
@media (max-width: 992px) {
    .tarot-container {
        min-height: 800px;
    }
    
    .shuffle-animation {
        height: 220px;
        margin: 1.5rem auto;
    }
    
    .animation-container {
        height: 120px;
        margin-bottom: 25px;
    }
    
    .card-floating {
        width: 60px;
        height: 90px;
    }
    
    .shuffle-text {
        font-size: 1.1em;
        padding: 12px 20px;
        width: 90%;
    }
    
    .celtic-cross-layout {
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: repeat(5, 160px);
        gap: 15px;
        max-width: 700px;
    }
    
    .pos-1 { grid-area: 2 / 2 / 3 / 3; }
    .pos-2 { grid-area: 2 / 2 / 3 / 3; }
    .pos-3 { grid-area: 1 / 2 / 2 / 3; }
    .pos-4 { grid-area: 3 / 2 / 4 / 3; }
    .pos-5 { grid-area: 2 / 1 / 3 / 2; }
    .pos-6 { grid-area: 2 / 3 / 3 / 4; }
    .pos-7 { grid-area: 5 / 2 / 6 / 3; }
    .pos-8 { grid-area: 4 / 2 / 5 / 3; }
    .pos-9 { grid-area: 3 / 3 / 4 / 4; }
    .pos-10 { grid-area: 3 / 1 / 4 / 2; }
    
    .card-display {
        grid-template-columns: 1fr;
        gap: 1.5rem;
    }
    
    .card-image {
        justify-content: center;
    }
    
    .card-image img {
        max-width: 250px;
    }
}

@media (max-width: 768px) {
    .tarot-container {
        min-height: 700px;
        padding-bottom: 60px;
    }
    
    .shuffle-area,
    .draw-area,
    .spread-area {
        padding: 1.5rem 1rem;
    }
    
    .shuffle-instruction h3,
    .draw-instruction h3,
    .spread-instruction h3 {
        font-size: 1.5rem;
    }
    
    .shuffle-instruction p,
    .draw-instruction p,
    .spread-instruction p {
        font-size: 1rem;
    }
    
    .shuffle-animation {
        height: 180px;
        margin: 1rem auto;
    }
    
    .animation-container {
        height: 100px;
        margin-bottom: 20px;
    }
    
    .card-floating {
        width: 50px;
        height: 75px;
    }
    
    .shuffle-text {
        font-size: 1em;
        padding: 10px 15px;
        width: 95%;
        max-width: 400px;
    }
    
    .draw-circle {
        width: 400px;
        height: 400px;
    }
    
    .celtic-cross-layout {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 40px;
        max-width: 100%;
    }
    
    .spread-position {
        width: 100%;
        max-width: 300px;
    }
    
    .pos-2 .card-label {
        transform: none;
        width: 120px;
        left: 50%;
        bottom: -70px;
    }
    
    .card-slot {
        width: 90px;
        height: 150px;
    }
    
    .modal-content {
        width: 95%;
        margin: 30px auto;
    }
    
    .modal-body {
        padding: 1.5rem;
    }
}

@media (max-width: 480px) {
    .tarot-container {
        min-height: 650px;
        padding-bottom: 40px;
    }
    
    .shuffle-area,
    .draw-area,
    .spread-area {
        padding: 1rem 0.75rem;
    }
    
    .shuffle-instruction h3,
    .draw-instruction h3,
    .spread-instruction h3 {
        font-size: 1.3rem;
    }
    
    .shuffle-instruction p,
    .draw-instruction p,
    .spread-instruction p {
        font-size: 0.95rem;
    }
    
    .shuffle-animation {
        height: 150px;
        margin: 0.75rem auto;
    }
    
    .animation-container {
        height: 80px;
        margin-bottom: 15px;
    }
    
    .card-floating {
        width: 40px;
        height: 60px;
    }
    
    .shuffle-text {
        font-size: 0.9em;
        padding: 8px 12px;
        width: 100%;
        max-width: 350px;
    }
    
    .draw-circle {
        width: 300px;
        height: 300px;
        margin: 1rem auto;
    }
    
    .spread-controls,
    .draw-controls,
    .shuffle-controls {
        flex-direction: column;
        gap: 0.75rem;
        align-items: center;
    }
    
    .spread-controls .btn,
    .draw-controls .btn,
    .shuffle-controls .btn {
        width: 100%;
        max-width: 250px;
    }
    
    .card-label {
        font-size: 0.8rem;
        width: 110px;
        bottom: -60px;
        padding: 6px 8px;
    }
    
    .modal-content {
        width: 98%;
        margin: 20px auto;
    }
    
    .modal-body {
        padding: 1rem;
    }
    
    .card-info h3 {
        font-size: 1.5rem;
    }
    
    .card-details {
        grid-template-columns: 1fr;
        gap: 0.75rem;
    }
}

/* 橫屏模式優化 */
@media (max-width: 768px) and (orientation: landscape) {
    .tarot-container {
        min-height: 500px;
    }
    
    .shuffle-animation {
        height: 160px;
        flex-direction: row;
        gap: 1rem;
    }
    
    .animation-container {
        height: 120px;
        width: 60%;
        margin-bottom: 0;
    }
    
    .shuffle-text {
        width: 40%;
        margin-top: 0;
        padding: 10px;
    }
    
    .celtic-cross-layout {
        grid-template-columns: repeat(3, 1fr);
        grid-template-rows: repeat(4, 140px);
        gap: 10px;
    }
    
    .pos-1 { grid-area: 2 / 1 / 3 / 2; }
    .pos-2 { grid-area: 2 / 1 / 3 / 2; }
    .pos-3 { grid-area: 1 / 1 / 2 / 2; }
    .pos-4 { grid-area: 3 / 1 / 4 / 2; }
    .pos-5 { grid-area: 2 / 2 / 3 / 3; }
    .pos-6 { grid-area: 2 / 3 / 3 / 4; }
    .pos-7 { grid-area: 4 / 1 / 5 / 2; }
    .pos-8 { grid-area: 4 / 2 / 5 / 3; }
    .pos-9 { grid-area: 4 / 3 / 5 / 4; }
    .pos-10 { grid-area: 3 / 2 / 4 / 3; }
}

/* 深色模式適配 */
@media (prefers-color-scheme: dark) {
    .shuffle-text {
        background: rgba(0, 0, 0, 0.8);
        color: var(--gold-bright);
        border-color: rgba(212, 175, 55, 0.5);
    }
    
    .card-label {
        background: rgba(0, 0, 0, 0.9);
        color: var(--gold-bright);
        border-color: var(--gold-primary);
    }
    
    .position-label {
        background: rgba(0, 0, 0, 0.7);
        color: var(--gold-primary);
        border-color: rgba(212, 175, 55, 0.4);
    }
    
    .card-slot {
        background: rgba(0, 0, 0, 0.3);
        border-color: rgba(255, 215, 0, 0.3);
    }
}

/* 打印樣式優化 */
@media print {
    .tarot-container {
        min-height: auto;
        padding-bottom: 0;
    }
    
    .shuffle-animation,
    .draw-area,
    .spread-controls,
    .draw-controls,
    .shuffle-controls {
        display: none !important;
    }
    
    .spread-area {
        display: block !important;
        padding: 0;
    }
    
    .celtic-cross-layout {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        grid-template-rows: repeat(2, auto);
        gap: 20px;
    }
    
    .spread-position {
        break-inside: avoid;
    }
    
    .card-label {
        opacity: 1 !important;
        color: #000 !important;
        background: #fff !important;
        border: 1px solid #000 !important;
        box-shadow: none !important;
    }
    
}
/* 在 tarot.css 末尾添加 */

/* 抽牌控制按鈕優化 */
.draw-controls {
    position: relative;
    z-index: 1000;
    margin-top: 2rem;
    display: flex;
    gap: 1rem;
    justify-content: center;
    width: 100%;
    pointer-events: auto;
}

/* 快速抽牌按鈕 */
#auto-draw {
    background: var(--gradient-gold);
    color: var(--dark-bg);
    border: 2px solid var(--gold-primary);
    font-weight: 700;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

#auto-draw::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    transition: left 0.5s;
}

#auto-draw:hover::before {
    left: 100%;
}

#auto-draw:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(212, 175, 55, 0.5);
}

#auto-draw:active {
    transform: translateY(-1px);
}

/* 完成抽牌按鈕 */
#finish-draw {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: 2px solid #667eea;
    font-weight: 700;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

#finish-draw::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    transition: left 0.5s;
}

#finish-draw:hover::before {
    left: 100%;
}

#finish-draw:hover:not(:disabled) {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
}

#finish-draw:active:not(:disabled) {
    transform: translateY(-1px);
}

/* 禁用狀態 */
#finish-draw:disabled {
    background: rgba(102, 126, 234, 0.5);
    color: rgba(255, 255, 255, 0.7);
    border-color: rgba(102, 126, 234, 0.3);
    cursor: not-allowed;
    transform: none !important;
    box-shadow: none !important;
}

#finish-draw:disabled::before {
    display: none;
}

/* 按鈕圖標 */
#auto-draw i,
#finish-draw i {
    transition: transform 0.3s ease;
}

#auto-draw:hover i {
    transform: scale(1.2);
}

#finish-draw:hover:not(:disabled) i {
    transform: scale(1.2);
}

/* 抽牌區域交互修復 */
.draw-circle {
    pointer-events: auto;
    touch-action: manipulation;
}

.tarot-card-draw {
    pointer-events: auto;
    cursor: pointer;
}

/* 確保按鈕不被遮擋 */
.draw-area {
    position: relative;
    z-index: 1;
}

.draw-controls {
    position: relative;
    z-index: 1000;
}

/* [FIX] iOS/Android：details/summary 點擊區域與換行 */
.tarot-overall-details summary, .tarot-gd-details summary{
  -webkit-tap-highlight-color: transparent;
}
.tarot-pos-detail, .cross-dim-evidence, .name-five-meaning, .tarot-detail-answer{
  word-break: break-word;
  overflow-wrap: anywhere;
}


/* === Added: Tarot Position Interaction === */
.tarot-pos-buttons { display: flex; flex-wrap: wrap; gap: 8px; margin: 10px 0 12px 0; }
.tarot-pos-btn { padding: 6px 10px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.16); background: rgba(255,255,255,0.06); color: inherit; cursor: pointer; }
.tarot-pos-btn.active { border-color: rgba(0, 200, 120, 0.55); background: rgba(0, 200, 120, 0.12); }
.pos-detail-card { border: 1px solid rgba(255,255,255,0.12); border-radius: 14px; padding: 12px; margin-top: 10px; }
.pos-detail-card .pos-h { display: flex; gap: 10px; align-items: baseline; flex-wrap: wrap; margin-bottom: 8px; }
.pos-detail-card .pos-n { font-weight: 900; }
.pos-detail-card .pos-name { font-weight: 800; }
.pos-detail-card .pos-card { opacity: 0.9; }
.pos-detail-card .pos-meaning { font-size: 13px; line-height: 1.65; opacity: 0.95; }

/* ==========================================
   V3 FIX - Riffle Shuffle（切半交叉洗牌）動畫
   目的：洗牌時顯示「兩疊牌切半交叉移動」並有牌背圖像
   ========================================== */

.shuffle-animation .riffle-container{
    position: relative;
    width: 260px;
    height: 180px;
    margin: 0 auto;
    background: none !important;
    background-image: none !important;
    background-color: transparent !important;
}

.shuffle-animation .riffle-pile{
    position: absolute;
    top: 50%;
    width: 120px;
    height: 160px;
    transform: translateY(-50%);
    display: block;
    background: none !important;
    background-image: none !important;
    background-color: transparent !important;
}

.shuffle-animation .riffle-pile.left{ left: 0; }
.shuffle-animation .riffle-pile.right{ right: 0; }

.shuffle-animation .riffle-card{
    position: absolute;
    width: 110px;
    height: 150px;
    border-radius: 10px;
    background-size: cover;
    background-position: center;
    box-shadow: 0 12px 30px rgba(0,0,0,0.35);
    transform-origin: bottom center;
    opacity: 0.98;
}

/* 左右兩疊：各自輕微抖動與向中間靠攏 */
.shuffle-animation .riffle-pile.left .riffle-card{
    left: 0;
    animation: riffleLeft 1.4s ease-in-out infinite;
    animation-delay: calc(var(--i) * 0.05s);
    z-index: calc(100 - var(--i));
}

.shuffle-animation .riffle-pile.right .riffle-card{
    right: 0;
    animation: riffleRight 1.4s ease-in-out infinite;
    animation-delay: calc(var(--i) * 0.05s);
    z-index: calc(100 - var(--i));
}

/* 模擬「交叉」：中段略往上掀、靠近中心、再回位 */
@keyframes riffleLeft{
    0%   { transform: translate(0, 0) rotate(-2deg); }
    35%  { transform: translate(46px, -10px) rotate(6deg); }
    60%  { transform: translate(60px, 6px) rotate(2deg); }
    100% { transform: translate(0, 0) rotate(-2deg); }
}

@keyframes riffleRight{
    0%   { transform: translate(0, 0) rotate(2deg); }
    35%  { transform: translate(-46px, -10px) rotate(-6deg); }
    60%  { transform: translate(-60px, 6px) rotate(-2deg); }
    100% { transform: translate(0, 0) rotate(2deg); }
}

/* 手機縮小 */
@media (max-width: 480px){
    .shuffle-animation .riffle-container{ width: 220px; height: 160px; }
    .shuffle-animation .riffle-pile{ width: 105px; height: 140px; }
    .shuffle-animation .riffle-card{ width: 96px; height: 132px; border-radius: 9px; }
}


/* === PATCH v4 RESULTS UI === */
.result-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
.result-card{background:rgba(20,20,30,.85);border:1px solid rgba(255,215,0,.35);border-radius:14px;padding:12px}
.result-card h4{color:#ffd700;font-size:14px;margin:0 0 6px}
.result-badge{display:inline-block;padding:2px 8px;border-radius:999px;background:#ffd700;color:#000;font-size:12px;margin-right:6px}
@media(max-width:768px){
  .result-grid{grid-template-columns:1fr}
}


/* ================================
 * v11 Tarot back image enforcement
 * ================================ */
:root{
  --tarot-back-url: url('../images/back.jpg');
}
/* Common back-face selectors */
.tarot-card.back,
.tarot-card.card-back,
.card-back,
.deck-card.back,
.deck-card.card-back,
.tarot-back,
.fan-card.back,
.fan-card.card-back,
.tarot-fan .card.back,
.tarot-fan .card.card-back{
  background-image: var(--tarot-back-url) !important;
  background-size: cover !important;
  background-position: center !important;
  background-repeat: no-repeat !important;
}
/* If using <img>, fall back to object-fit */
img.tarot-back, img.card-back{
  object-fit: cover;
}
/* Riffle shuffle visual (best-effort, applied when class added by JS) */
@keyframes jy-riffle-left{
  0%{ transform: translateX(0) rotate(0deg); }
  45%{ transform: translateX(-18px) rotate(-6deg); }
  70%{ transform: translateX(0) rotate(0deg); }
  100%{ transform: translateX(0) rotate(0deg); }
}
@keyframes jy-riffle-right{
  0%{ transform: translateX(0) rotate(0deg); }
  45%{ transform: translateX(18px) rotate(6deg); }
  70%{ transform: translateX(0) rotate(0deg); }
  100%{ transform: translateX(0) rotate(0deg); }
}
.jy-riffle .deck-half.left{ animation: jy-riffle-left 700ms ease-in-out 1; }
.jy-riffle .deck-half.right{ animation: jy-riffle-right 700ms ease-in-out 1; }

/* ================================
   Riffle Shuffle（兩疊牌交錯洗牌）
   ================================ */
.shuffle-animation .riffle-wrap,
.riffle-wrap {
    position: relative;
    width: 100%;
    max-width: 800px;
    height: 170px;
    margin: 0 auto;
    pointer-events: none;
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    background: none !important;
    background-image: none !important;
    background-color: transparent !important;
    /* 確保居中 */
    left: auto;
    right: auto;
    transform: none;
}

.shuffle-animation .riffle-pile,
.riffle-pile {
    position: absolute;
    top: 50%;
    width: 220px;
    height: 140px;
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    background: none !important;
    background-image: none !important;
    background-color: transparent !important;
}

.shuffle-animation .riffle-pile.left,
.riffle-pile.left { 
    left: 50%;
    transform: translateY(-50%) translateX(-200px);
}

.shuffle-animation .riffle-pile.right,
.riffle-pile.right { 
    left: 50%;
    transform: translateY(-50%) translateX(200px);
}

.shuffle-animation .riffle-card,
.riffle-card {
    position: absolute !important;
    width: 70px !important;
    height: 105px !important;
    border-radius: 8px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.35) !important;
    border: 1px solid rgba(212, 175, 55, 0.5);
    background-image: url('../images/back.jpg') !important;
    background-size: cover !important;
    background-position: center !important;
    background-repeat: no-repeat !important;
    top: calc(var(--i) * 1px) !important;
    left: 0 !important;
    opacity: 1 !important;
    visibility: visible !important;
    display: block !important;
    animation-duration: 2.3s !important;
    animation-timing-function: ease-in-out !important;
    animation-fill-mode: forwards !important;
    animation-delay: var(--d) !important;
    animation-iteration-count: 1 !important;
    z-index: 10;
}

.shuffle-animation .riffle-pile.right .riffle-card,
.riffle-pile.right .riffle-card {
    animation-delay: calc(var(--d) + 0.022s) !important;
}

.shuffle-animation .riffle-pile.left .riffle-card:nth-child(odd),
.riffle-pile.left .riffle-card:nth-child(odd)  { 
    animation-name: riffleLeftOdd !important; 
}
.shuffle-animation .riffle-pile.left .riffle-card:nth-child(even),
.riffle-pile.left .riffle-card:nth-child(even) { 
    animation-name: riffleLeftEven !important; 
}
.shuffle-animation .riffle-pile.right .riffle-card:nth-child(odd),
.riffle-pile.right .riffle-card:nth-child(odd)  { 
    animation-name: riffleRightOdd !important; 
}
.shuffle-animation .riffle-pile.right .riffle-card:nth-child(even),
.riffle-pile.right .riffle-card:nth-child(even) { 
    animation-name: riffleRightEven !important; 
}

@keyframes riffleLeftOdd {
    0%   { transform: translateX(0) rotate(-6deg); opacity: 1; }
    55%  { transform: translateX(195px) rotate(-2deg); opacity: 1; }
    100% { transform: translateX(200px) translateY(14px) rotate(0deg); opacity: 1; }
}
@keyframes riffleLeftEven {
    0%   { transform: translateX(0) rotate(-6deg); opacity: 1; }
    55%  { transform: translateX(205px) rotate(-1deg); opacity: 1; }
    100% { transform: translateX(210px) translateY(26px) rotate(0deg); opacity: 1; }
}
@keyframes riffleRightOdd {
    0%   { transform: translateX(0) rotate(6deg); opacity: 1; }
    55%  { transform: translateX(-195px) rotate(2deg); opacity: 1; }
    100% { transform: translateX(-200px) translateY(14px) rotate(0deg); opacity: 1; }
}
@keyframes riffleRightEven {
    0%   { transform: translateX(0) rotate(6deg); opacity: 1; }
    55%  { transform: translateX(-205px) rotate(1deg); opacity: 1; }
    100% { transform: translateX(-210px) translateY(26px) rotate(0deg); opacity: 1; }
}
