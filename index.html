<!DOCTYPE html>
    <html lang="zh-TW">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
        <meta name="description" content="靜月之光能量占卜儀：整合八字、梅花易數、塔羅牌的多維度機率評估，提供專屬五行水晶開運建議。">
        <meta name="keywords" content="八字,梅花易數,塔羅牌,命理,占卜,五行,水晶,開運">
        <meta name="theme-color" content="#1a1520">
        <meta property="og:title" content="靜月之光能量占卜儀 v2.0">
        <meta property="og:description" content="整合八字、梅花易數、塔羅牌的多維度機率評估，提供專屬五行水晶開運建議。">
        <meta property="og:type" content="website">
        <meta property="og:locale" content="zh_TW">
        <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
        <meta http-equiv="Pragma" content="no-cache">
        <meta http-equiv="Expires" content="0">
        <title>靜月之光能量占卜儀 v2.0</title>
        
        <link rel="stylesheet" href="css/main.css?v=HOTFIX-20260203-E">
        <link rel="stylesheet" href="css/tarot.css?v=HOTFIX-20260203-E">
        <link rel="stylesheet" href="css/bazi-display.css?v=HOTFIX-20260203-E">
        <link rel="stylesheet" href="css/responsive.css?v=HOTFIX-20260203-E">

        <!-- 設計系統與 Wizard 分步式流程 -->
        <link rel="stylesheet" href="css/design-system.css?v=2.0.0">
        <link rel="stylesheet" href="css/wizard.css?v=2.0.0">

        <link rel="stylesheet" href="css/ios-fixes.css?v=HOTFIX-20260203-E">
        <link rel="stylesheet" href="css/mobile-fix.css?v=HOTFIX-20260203-E">
        <link rel="stylesheet" href="css/result-section-override.css?v=HOTFIX-20260203-E">
        <link rel="stylesheet" href="css/mobile-scroll.css?v=HOTFIX-20260203-E">
        <!-- 手機：單一捲動容器 #page-scroll，避免 body 捲動在部分機型失效 -->
        <script>
        (function(){
          function setVh(){ try { document.documentElement.style.setProperty('--vh', (window.innerHeight * 0.01) + 'px'); } catch(e){} }
          if (typeof window !== 'undefined') {
            window.addEventListener('resize', setVh);
            window.addEventListener('orientationchange', setVh);
            setVh();
          }
        })();
        </script>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
        <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <link rel="icon" href="images/logo.jpg" type="image/jpeg">
        <script>if(document.location.protocol.match(/^https?:$/)){var l=document.createElement('link');l.rel='manifest';l.href='manifest.json?v=HOTFIX-20260203-E';document.head.appendChild(l);}</script>
        <link rel="apple-touch-icon" href="images/logo.jpg">
        <script type="application/ld+json">
        {"@context":"https://schema.org","@type":"WebApplication","name":"靜月之光能量占卜儀","description":"整合八字、梅花易數、塔羅牌的多維度機率評估，提供專屬五行水晶開運建議","applicationCategory":"LifestyleApplication","inLanguage":"zh-TW"}
        </script>
    </head>
    <body>
        <div id="page-scroll" class="page-scroll">
        <noscript><p style="padding:2rem;text-align:center;background:#1a1520;color:#D4AF37;">本系統需啟用 JavaScript 才能運作，請在瀏覽器設定中開啟後重新整理頁面。</p></noscript>
        <a href="#main-content" class="skip-link">跳至主要內容</a>
        <nav class="navbar">
            <div class="nav-container">
                <a href="https://sites.google.com/view/jingyue-light/" target="_blank" class="logo" rel="noopener noreferrer">
                    <img src="images/logo.jpg" alt="靜月之光能量占卜儀" class="logo-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='inline-block';">
                    <i class="fas fa-moon" style="display:none;"></i>
                    <span>靜月之光能量占卜儀 v2.0</span>
                </a>
                <div class="nav-mode-toggle" style="display: none;">
                    <button type="button" id="toggle-wizard-mode" class="btn btn--ghost btn--sm">
                        <i class="fas fa-exchange-alt"></i>
                        <span class="sm:hidden">切換模式</span>
                    </button>
                </div>
                <div class="nav-shop-buttons">
                    <a href="https://tw.shp.ee/2n5Mo2w" target="_blank" class="shop-btn shop-btn-shopee" rel="noopener noreferrer" title="🛒 蝦皮逛逛（免運＋關注9折）">
                        <i class="fas fa-shopping-cart"></i> 蝦皮逛逛
                    </a>
                    <a href="https://myship.7-11.com.tw/seller/profile?id=GM2601091690232" target="_blank" class="shop-btn shop-btn-711" rel="noopener noreferrer" title="📦 賣貨便（滿千免運）">
                        <i class="fas fa-box"></i> 賣貨便
                    </a>
                </div>
            </div>
        </nav>
    
        <!-- 全頁載入遮罩（計算八字時顯示） -->
        <div id="global-loading-overlay" class="global-loading-overlay" aria-live="polite" aria-busy="false" hidden>
            <div class="global-loading-content">
                <i class="fas fa-spinner fa-spin"></i>
                <span>正在計算八字命盤...</span>
            </div>
        </div>

        <main id="main-content" class="main-container" tabindex="-1">
    <!-- ============================================
         全域提示容器
         ============================================ -->
    <div id="wizard-alerts" aria-live="polite" aria-atomic="true" style="position: fixed; top: 80px; right: 16px; z-index: 1060; max-width: 400px;"></div>

    <!-- ============================================
         進度指示器(Stepper)
         ============================================ -->
    <div class="stepper" role="tablist" aria-label="占卜流程步驟">
        <div class="stepper__step" data-step="0">
            <div class="stepper__icon">1</div>
            <span class="stepper__label">歡迎</span>
        </div>
        <div class="stepper__line"></div>

        <div class="stepper__step" data-step="1">
            <div class="stepper__icon">2</div>
            <span class="stepper__label">基本</span>
        </div>
        <div class="stepper__line"></div>

        <div class="stepper__step" data-step="2">
            <div class="stepper__icon">3</div>
            <span class="stepper__label">出生</span>
        </div>
        <div class="stepper__line"></div>

        <div class="stepper__step" data-step="3">
            <div class="stepper__icon">4</div>
            <span class="stepper__label">問題</span>
        </div>
        <div class="stepper__line"></div>

        <div class="stepper__step" data-step="4">
            <div class="stepper__icon">5</div>
            <span class="stepper__label">確認</span>
        </div>
    </div>

    <!-- ============================================
         Wizard 容器
         ============================================ -->
    <div class="wizard">
        <!-- Wizard Header -->
        <div class="wizard__header">
            <button class="wizard__back" data-wizard-prev aria-label="返回上一步">
                <i class="fas fa-arrow-left"></i>
            </button>
            <div class="wizard__progress">
                <span class="wizard__step-number">步驟 1 / 9</span>
                <div class="wizard__progress-bar" role="progressbar" aria-valuenow="11" aria-valuemin="0" aria-valuemax="100">
                    <div class="wizard__progress-fill" style="width: 11%"></div>
                </div>
            </div>
        </div>

        <!-- ============================================
             Step 0: 歡迎頁
             ============================================ -->
        <div data-wizard-step="0" style="display: block;">
            <div class="welcome-hero">
                <div class="welcome-hero__icon">🌙</div>
                <h1 class="welcome-hero__title">靜月之光能量占卜儀</h1>
                <p class="welcome-hero__subtitle">
                    整合八字、梅花易數、塔羅牌的多維度機率評估<br>
                    提供專屬五行水晶開運建議
                </p>

                <div class="alert alert--info" style="max-width: 500px; margin: 0 auto var(--space-6);">
                    <i class="fas fa-info-circle alert__icon"></i>
                    <div class="alert__content">
                        <div class="alert__message">
                            ⚠️ 本系統結合多維度數據提供能量校準建議,非宿命論,僅供參考。
                        </div>
                    </div>
                </div>

                <div class="welcome-hero__cta">
                    <button class="btn btn--primary btn--xl" data-wizard-next>
                        <i class="fas fa-star"></i>
                        <span>開始占卜分析</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- ============================================
             Step 1: 基本資料
             ============================================ -->
        <div data-wizard-step="1" style="display: none;">
            <div class="wizard__content">
                <h2 class="wizard__title">基本資料</h2>
                <p class="wizard__description">請提供您的基本資訊,我們將為您進行姓名學分析</p>

                <div class="wizard__form">
                    <!-- 姓名 -->
                    <div class="form-field">
                        <label class="form-field__label" for="name">
                            <i class="fas fa-user"></i>
                            <span>姓名</span>
                            <span class="form-field__required">*</span>
                        </label>
                        <input
                            type="text"
                            id="name"
                            name="name"
                            class="form-field__input"
                            placeholder="請輸入中文姓名"
                            data-wizard-field="name"
                            required
                            autocomplete="name"
                        >
                        <span class="form-field__hint">將用於姓名學分析</span>
                        <span class="form-field__error">請輸入2-10個中文字</span>
                    </div>

                    <!-- 性別 -->
                    <div class="form-field">
                        <label class="form-field__label">
                            <i class="fas fa-venus-mars"></i>
                            <span>性別</span>
                            <span class="form-field__required">*</span>
                        </label>
                        <div class="radio-group radio-group--pills" role="group" aria-label="性別選擇">
                            <label class="radio-label radio-label--pill">
                                <input type="radio" name="gender" value="male" data-wizard-field="gender">
                                <span class="radio-text">男</span>
                            </label>
                            <label class="radio-label radio-label--pill">
                                <input type="radio" name="gender" value="female" data-wizard-field="gender">
                                <span class="radio-text">女</span>
                            </label>
                        </div>
                        <span class="form-field__error">請選擇性別</span>
                    </div>
                </div>
            </div>

            <div class="wizard__footer">
                <button class="btn btn--secondary btn--md" data-wizard-prev>
                    <i class="fas fa-arrow-left"></i>
                    <span>上一步</span>
                </button>
                <button class="btn btn--primary btn--md" data-wizard-next>
                    <span>下一步</span>
                    <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- ============================================
             Step 2: 出生資訊
             ============================================ -->
        <div data-wizard-step="2" style="display: none;">
            <div class="wizard__content">
                <h2 class="wizard__title">出生資訊</h2>
                <p class="wizard__description">請提供您的出生日期與時間,我們將精準計算八字命盤</p>

                <div class="wizard__form">
                    <!-- 出生日期 -->
                    <div class="form-field">
                        <label class="form-field__label" for="birth-date">
                            <i class="fas fa-calendar"></i>
                            <span>出生日期</span>
                            <span class="form-field__required">*</span>
                        </label>
                        <input
                            type="date"
                            id="birth-date"
                            name="birthDate"
                            class="form-field__input"
                            data-wizard-field="birthDate"
                            required
                        >
                        <span class="form-field__hint">例如:1990年6月15日</span>
                        <span class="form-field__error">請選擇出生日期</span>
                    </div>

                    <!-- 出生時間 -->
                    <div class="form-field">
                        <label class="form-field__label" for="birth-time">
                            <i class="fas fa-clock"></i>
                            <span>出生時間</span>
                        </label>
                        <input
                            type="time"
                            id="birth-time"
                            name="birthTime"
                            class="form-field__input"
                            data-wizard-field="birthTime"
                        >
                        <span class="form-field__hint">請盡量精確,用於時柱計算(例如:10:30)。不確定可留空,將以12:00計算</span>
                    </div>

                    <!-- 出生國家/地區 -->
                    <div class="form-field">
                        <label class="form-field__label" for="birth-country">
                            <i class="fas fa-globe-asia"></i>
                            <span>出生國家/地區</span>
                            <span class="form-field__required">*</span>
                        </label>
                        <select
                            id="birth-country"
                            name="birthCountry"
                            class="form-field__select"
                            data-wizard-field="birthCountry"
                            required
                        >
                            <option value="">選擇國家/地區</option>
                            <option value="TW">台灣</option>
                            <option value="CN">中國大陸</option>
                            <option value="HK">香港</option>
                            <option value="MO">澳門</option>
                            <option value="other">其他地區</option>
                        </select>
                        <span class="form-field__error">請選擇出生國家/地區</span>
                    </div>

                    <!-- 出生城市 -->
                    <div class="form-field" id="city-container">
                        <label class="form-field__label" for="birth-city">
                            <i class="fas fa-city"></i>
                            <span>出生城市</span>
                            <span class="form-field__required">*</span>
                        </label>
                        <select
                            id="birth-city"
                            name="birthCity"
                            class="form-field__select"
                            data-wizard-field="birthCity"
                            required
                        >
                            <option value="">請先選擇地區</option>
                        </select>
                        <div id="city-coordinates" class="form-field__hint" style="display:none;">
                            經度: <span id="longitude">-</span>°E | 緯度: <span id="latitude">-</span>°N
                        </div>
                        <span class="form-field__error">請選擇出生城市</span>
                    </div>

                    <!-- 真太陽時校正 -->
                    <div class="card" id="solar-time-section">
                        <div class="card__header">
                            <i class="fas fa-sun card__icon"></i>
                            <h3 class="card__title">真太陽時校正</h3>
                        </div>
                        <div class="card__body">
                            <p style="font-size: var(--text-sm); color: var(--color-text-secondary); margin-bottom: var(--space-4);">
                                依出生地經度校正鐘錶時間為「真太陽時」,可提高八字時柱與大運起算的準確度。
                            </p>
                            <div id="solar-time-location-hint" style="font-size: var(--text-sm); color: var(--color-text-muted); margin-bottom: var(--space-3);">
                                <i class="fas fa-map-marker-alt"></i>
                                <span id="solar-location-text">請先選擇出生地區與城市</span>
                            </div>
                            <label style="display: flex; align-items: center; gap: var(--space-3); cursor: pointer;">
                                <input
                                    type="checkbox"
                                    id="true-solar-time"
                                    name="useTrueSolarTime"
                                    data-wizard-field="useTrueSolarTime"
                                    style="width: 20px; height: 20px; cursor: pointer;"
                                >
                                <span style="font-weight: var(--font-medium);">啟用校正</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="wizard__footer">
                <button class="btn btn--secondary btn--md" data-wizard-prev>
                    <i class="fas fa-arrow-left"></i>
                    <span>上一步</span>
                </button>
                <button class="btn btn--primary btn--md" data-wizard-next>
                    <span>下一步</span>
                    <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- ============================================
             Step 3: 問題類型
             ============================================ -->
        <div data-wizard-step="3" style="display: none;">
            <div class="wizard__content">
                <h2 class="wizard__title">諮詢問題</h2>
                <p class="wizard__description">請選擇問題類型並輸入您想諮詢的具體問題</p>

                <div class="wizard__form">
                    <!-- 問題類型選擇(卡片式) -->
                    <div class="form-field">
                        <label class="form-field__label">
                            <i class="fas fa-tag"></i>
                            <span>問題類型</span>
                            <span class="form-field__required">*</span>
                        </label>
                        <div class="choice-grid" id="question-type-grid">
                            <label class="choice-card">
                                <input type="radio" name="questionType" value="love" data-wizard-field="questionType">
                                <div class="choice-card__icon">💕</div>
                                <div class="choice-card__title">愛情</div>
                                <div class="choice-card__description">感情、婚姻、伴侶關係</div>
                            </label>

                            <label class="choice-card">
                                <input type="radio" name="questionType" value="career" data-wizard-field="questionType">
                                <div class="choice-card__icon">💼</div>
                                <div class="choice-card__title">事業</div>
                                <div class="choice-card__description">工作、職涯發展、創業</div>
                            </label>

                            <label class="choice-card">
                                <input type="radio" name="questionType" value="wealth" data-wizard-field="questionType">
                                <div class="choice-card__icon">💰</div>
                                <div class="choice-card__title">財運</div>
                                <div class="choice-card__description">投資、理財、收入</div>
                            </label>

                            <label class="choice-card">
                                <input type="radio" name="questionType" value="health" data-wizard-field="questionType">
                                <div class="choice-card__icon">🏥</div>
                                <div class="choice-card__title">健康</div>
                                <div class="choice-card__description">身體狀況、養生保健</div>
                            </label>

                            <label class="choice-card">
                                <input type="radio" name="questionType" value="general" data-wizard-field="questionType">
                                <div class="choice-card__icon">🌟</div>
                                <div class="choice-card__title">運勢(綜合)</div>
                                <div class="choice-card__description">整體運勢走向</div>
                            </label>

                            <label class="choice-card">
                                <input type="radio" name="questionType" value="relationship" data-wizard-field="questionType">
                                <div class="choice-card__icon">👥</div>
                                <div class="choice-card__title">人際</div>
                                <div class="choice-card__description">人際關係、合作夥伴</div>
                            </label>

                            <label class="choice-card">
                                <input type="radio" name="questionType" value="family" data-wizard-field="questionType">
                                <div class="choice-card__icon">🏠</div>
                                <div class="choice-card__title">家庭</div>
                                <div class="choice-card__description">家人關係、家庭和諧</div>
                            </label>

                            <label class="choice-card">
                                <input type="radio" name="questionType" value="other" data-wizard-field="questionType">
                                <div class="choice-card__icon">❓</div>
                                <div class="choice-card__title">其他</div>
                                <div class="choice-card__description">自訂問題</div>
                            </label>
                        </div>
                        <span class="form-field__error">請選擇問題類型</span>
                    </div>

                    <!-- 具體問題 -->
                    <div class="form-field">
                        <label class="form-field__label" for="question">
                            <i class="fas fa-question-circle"></i>
                            <span>諮詢問題</span>
                            <span class="form-field__required">*</span>
                        </label>
                        <textarea
                            id="question"
                            name="question"
                            class="form-field__textarea"
                            rows="4"
                            placeholder="請輸入您想諮詢的問題..."
                            data-wizard-field="question"
                            maxlength="500"
                            required
                        ></textarea>
                        <span class="form-field__hint" id="question-char-hint">0/500 字</span>
                        <span class="form-field__error">問題至少需要5個字</span>
                    </div>

                    <!-- 系統說明 -->
                    <div class="alert alert--warning">
                        <i class="fas fa-info-circle alert__icon"></i>
                        <div class="alert__content">
                            <div class="alert__title">本系統運作方式</div>
                            <div class="alert__message">
                                以「問題導向」整合八字、梅花易數、塔羅牌、紫微斗數,輸出多維度機率評估與直接答案,不提供單一確定結論。
                                依八字喜用神與卦象徵,提供專屬五行水晶配戴建議,供能量校準參考(非醫療或命運保證)。
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="wizard__footer">
                <button class="btn btn--secondary btn--md" data-wizard-prev>
                    <i class="fas fa-arrow-left"></i>
                    <span>上一步</span>
                </button>
                <button class="btn btn--primary btn--md" data-wizard-next>
                    <span>下一步</span>
                    <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- ============================================
             Step 4: 資料確認
             ============================================ -->
        <div data-wizard-step="4" style="display: none;">
            <div class="wizard__content">
                <h2 class="wizard__title">確認資料</h2>
                <p class="wizard__description">請檢查以下資訊是否正確,確認後將開始分析</p>

                <div class="wizard__form">
                    <!-- 基本資料摘要 -->
                    <div class="confirmation-card">
                        <div class="confirmation-card__header">
                            <h3 class="confirmation-card__title">基本資料</h3>
                            <a href="#" class="confirmation-card__edit" data-wizard-goto="1">
                                <i class="fas fa-edit"></i>
                                <span>編輯</span>
                            </a>
                        </div>
                        <div class="confirmation-card__body">
                            <div class="confirmation-item">
                                <span class="confirmation-item__label">姓名:</span>
                                <span class="confirmation-item__value" id="confirm-name">-</span>
                            </div>
                            <div class="confirmation-item">
                                <span class="confirmation-item__label">性別:</span>
                                <span class="confirmation-item__value" id="confirm-gender">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- 出生資訊摘要 -->
                    <div class="confirmation-card">
                        <div class="confirmation-card__header">
                            <h3 class="confirmation-card__title">出生資訊</h3>
                            <a href="#" class="confirmation-card__edit" data-wizard-goto="2">
                                <i class="fas fa-edit"></i>
                                <span>編輯</span>
                            </a>
                        </div>
                        <div class="confirmation-card__body">
                            <div class="confirmation-item">
                                <span class="confirmation-item__label">日期:</span>
                                <span class="confirmation-item__value" id="confirm-birth-date">-</span>
                            </div>
                            <div class="confirmation-item">
                                <span class="confirmation-item__label">時間:</span>
                                <span class="confirmation-item__value" id="confirm-birth-time">-</span>
                            </div>
                            <div class="confirmation-item">
                                <span class="confirmation-item__label">地點:</span>
                                <span class="confirmation-item__value" id="confirm-birth-location">-</span>
                            </div>
                            <div class="confirmation-item">
                                <span class="confirmation-item__label">真太陽時:</span>
                                <span class="confirmation-item__value" id="confirm-solar-time">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- 問題摘要 -->
                    <div class="confirmation-card">
                        <div class="confirmation-card__header">
                            <h3 class="confirmation-card__title">問題類型</h3>
                            <a href="#" class="confirmation-card__edit" data-wizard-goto="3">
                                <i class="fas fa-edit"></i>
                                <span>編輯</span>
                            </a>
                        </div>
                        <div class="confirmation-card__body">
                            <div class="confirmation-item">
                                <span class="confirmation-item__label">類型:</span>
                                <span class="confirmation-item__value" id="confirm-question-type">-</span>
                            </div>
                            <div class="confirmation-item" style="flex-direction: column; align-items: flex-start;">
                                <span class="confirmation-item__label">問題:</span>
                                <span class="confirmation-item__value" id="confirm-question" style="text-align: left; margin-top: var(--space-2);">-</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="wizard__footer">
                <button class="btn btn--secondary btn--md" data-wizard-prev>
                    <i class="fas fa-arrow-left"></i>
                    <span>上一步</span>
                </button>
                <button class="btn btn--primary btn--lg" data-wizard-next>
                    <i class="fas fa-check-circle"></i>
                    <span>確認開始分析</span>
                </button>
            </div>
        </div>

        <!-- ============================================
             Step 5: 計算中
             ============================================ -->
        <div data-wizard-step="5" style="display: none;">
            <div class="loading-screen">
                <div class="loading-screen__spinner">
                    <div class="spinner spinner--lg"></div>
                </div>
                <h2 class="loading-screen__title">正在計算您的八字命盤...</h2>
                <div class="loading-screen__progress">
                    <div class="wizard__progress-bar">
                        <div class="wizard__progress-fill" id="calc-progress-fill" style="width: 0%"></div>
                    </div>
                </div>
                <p class="loading-screen__hint">
                    八字命盤是根據出生時間的天干地支組合推算,能反映個人的五行屬性與命運走向...
                </p>
            </div>
        </div>

        <!-- ============================================
             Step 6: 梅花起卦(保留原系統)
             ============================================ -->
        <div data-wizard-step="6" style="display: none;">
            <div class="wizard__content">
                <h2 class="wizard__title">梅花易數起卦</h2>
                <p class="wizard__description">請選擇起卦方式進行梅花易數占卜</p>

                <div class="wizard__form">
                    <!-- 此處保留原 meihua-section 的內容 -->
                    <div id="meihua-content-placeholder">
                        <!-- 將由 JavaScript 動態載入原梅花系統 -->
                    </div>
                </div>
            </div>

            <div class="wizard__footer">
                <button class="btn btn--secondary btn--md" data-wizard-prev>
                    <i class="fas fa-arrow-left"></i>
                    <span>上一步</span>
                </button>
                <button class="btn btn--primary btn--md" data-wizard-next>
                    <span>繼續</span>
                    <i class="fas fa-arrow-right"></i>
                </button>
                <button class="btn btn--ghost btn--md" id="skip-meihua-wizard">
                    <i class="fas fa-forward"></i>
                    <span>跳過梅花</span>
                </button>
            </div>
        </div>

        <!-- ============================================
             Step 7: 塔羅抽牌(保留原系統)
             ============================================ -->
        <div data-wizard-step="7" style="display: none;">
            <div class="wizard__content">
                <h2 class="wizard__title">金色黎明塔羅牌</h2>
                <p class="wizard__description">請抽取10張牌進行凱爾特十字牌陣占卜</p>

                <div class="wizard__form">
                    <!-- 此處保留原 tarot-section 的內容 -->
                    <div id="tarot-content-placeholder">
                        <!-- 將由 JavaScript 動態載入原塔羅系統 -->
                    </div>
                </div>
            </div>

            <div class="wizard__footer">
                <button class="btn btn--secondary btn--md" data-wizard-prev>
                    <i class="fas fa-arrow-left"></i>
                    <span>上一步</span>
                </button>
                <button class="btn btn--ghost btn--md" id="skip-tarot-wizard">
                    <i class="fas fa-forward"></i>
                    <span>跳過塔羅牌</span>
                </button>
            </div>
        </div>

        <!-- ============================================
             Step 8: 結果展示(保留原系統)
             ============================================ -->
        <div data-wizard-step="8" style="display: none;">
            <div class="wizard__content">
                <h2 class="wizard__title">綜合分析結果</h2>
                <p class="wizard__description">以下是根據您的資料進行的多維度分析</p>

                <div class="wizard__form">
                    <!-- 此處保留原 result-section 的內容 -->
                    <div id="result-content-placeholder">
                        <!-- 將由 JavaScript 動態載入原結果系統 -->
                    </div>
                </div>
            </div>

            <div class="wizard__footer">
                <button class="btn btn--secondary btn--md" onclick="location.reload()">
                    <i class="fas fa-redo"></i>
                    <span>重新開始</span>
                </button>
                <button class="btn btn--primary btn--md" onclick="window.print()">
                    <i class="fas fa-print"></i>
                    <span>列印結果</span>
                </button>
            </div>
        </div>
    </div>

    <!-- ============================================
         隱藏區:保留原系統的 Section(供向後兼容)
         ============================================ -->
    <div style="display: none;">
        <!-- 保留原 bazi-section, meihua-section, tarot-section, result-section -->
        <!-- 供舊版 JavaScript 引用,避免報錯 -->
        <section id="input-section" class="section"></section>
        <section id="bazi-section" class="section"></section>
        <section id="meihua-section" class="section"></section>
        <section id="tarot-section" class="section"></section>
        <section id="result-section" class="section"></section>
    </div>

        </main></main>
        
        <!-- 客製表單模態框 -->
        <div class="custom-order-modal" id="custom-order-modal">
            <div class="modal-overlay"></div>
            <div class="modal-content-custom">
                <button class="modal-close-btn" id="close-custom-modal">
                    <i class="fas fa-times"></i>
                </button>
                <div class="modal-header-custom">
                    <i class="fas fa-magic"></i>
                    <h2>能量手鍊客製服務</h2>
                </div>
                <form class="custom-order-form" id="custom-order-form">
                    <div class="form-group-custom">
                        <label for="custom-name"><i class="fas fa-user"></i> 姓名</label>
                        <input type="text" id="custom-name" name="name" placeholder="請輸入您的姓名" required>
                    </div>
                    <div class="form-group-custom">
                        <label for="custom-birthday"><i class="fas fa-calendar"></i> 出生日期</label>
                        <input type="date" id="custom-birthday" name="birthday" required>
                    </div>
                    <div class="form-group-custom">
                        <label for="custom-question"><i class="fas fa-question-circle"></i> 想解決的問題</label>
                        <textarea id="custom-question" name="question" rows="3" placeholder="例如：想提升事業運、改善感情、招財等..." required></textarea>
                    </div>
                    <div class="form-group-custom">
                        <label for="custom-budget"><i class="fas fa-dollar-sign"></i> 預算範圍</label>
                        <select id="custom-budget" name="budget" required>
                            <option value="">請選擇預算範圍</option>
                            <option value="預算版（$1,000 - $3,000）">預算版（$1,000 - $3,000）</option>
                            <option value="加強版（$3,000 - $6,000）">加強版（$3,000 - $6,000）</option>
                            <option value="收藏版（$6,000 以上）">收藏版（$6,000 以上）</option>
                        </select>
                    </div>
                    <div class="form-actions-custom">
                        <button type="button" class="btn-cancel" id="cancel-custom-form">取消</button>
                        <button type="submit" class="btn-submit-custom" id="submit-custom-form">
                            <i class="fas fa-paper-plane"></i> 送出詢問
                        </button>
                    </div>
                    <div id="form-status" class="form-status-message" style="display: none; margin-top: 1rem; padding: 1rem; border-radius: var(--border-radius-sm); text-align: center;"></div>
                </form>
                
                <!-- 郵件內容顯示區（提交後顯示，在表單外） -->
                <div class="email-content-display" id="email-content-display" style="display: none;">
                    <div class="email-content-header">
                        <i class="fas fa-envelope-open"></i>
                        <h4>郵件內容已準備好</h4>
                    </div>
                    <div class="email-info-box">
                        <div class="email-info-item">
                            <label>主旨：</label>
                            <div class="email-value-copy">
                                <span id="email-subject-display"></span>
                                <button class="btn-copy" id="copy-subject-btn" title="複製">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        </div>
                        <div class="email-info-item full-width">
                            <label>內容：</label>
                            <div class="email-content-box">
                                <textarea id="email-body-display" readonly></textarea>
                                <button class="btn-copy-full" id="copy-body-btn" title="複製全部內容">
                                    <i class="fas fa-copy"></i> 複製全部內容
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="email-instructions">
                        <i class="fas fa-info-circle"></i>
                        <p><strong>郵件內容已自動複製到剪貼板！</strong></p>
                        <p>請按照以下步驟發送郵件：</p>
                        <ol style="margin: 0.5rem 0; padding-left: 1.5rem;">
                            <li>開啟您的郵件應用程式（Gmail、Outlook、Apple Mail 等）</li>
                            <li>點擊下方連結，郵件客戶端會自動填入收件人與內容</li>
                            <li>確認後點擊發送</li>
                        </ol>
                        <p class="email-alt-link" style="margin-top: 1rem;">請點擊：<a href="#" id="open-email-link" target="_blank" rel="noopener">開啟郵件客戶端</a>（設備支援時會自動填入）</p>
                    </div>
                </div>
            </div>
        </div>
        </div>
        </div>
        </div>
        <!-- #page-scroll 結束 -->

        <!-- 右側浮動按鈕：body 直屬全域層，由 JS 渲染到 #global-floating-root，避免 stacking context 被內容蓋住 -->
        <div id="global-floating-root" aria-label="全站浮動操作"></div>
    
        <!-- scroll-rescue.js 已移除：止血，避免 monkey patch 與全域 overflow 覆蓋 -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lunar-javascript/1.7.4/lunar.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/iztro@2/dist/iztro.min.js"></script>
        <script src="js/scrollLockManager.js?v=HOTFIX-20260203-E"></script>
        <script src="js/scroll-debug.js?v=HOTFIX-20260203-E"></script>
        <script src="js/ziwei-system.js?v=HOTFIX-20260203-E"></script>
        <script src="js/true-solar-time.js?v=HOTFIX-20260203-E"></script>
        <script src="js/solar-term-calculator.js?v=HOTFIX-20260203-E"></script>
        <script src="js/shichen-system.js?v=HOTFIX-20260203-E"></script>
        <script src="js/dayun-calculator.js?v=HOTFIX-20260203-E"></script>
        <script src="js/liunian-calculator.js?v=HOTFIX-20260203-E"></script>
        <script src="js/auxiliary-data.js?v=HOTFIX-20260203-E"></script>
        <script src="logic/chenggu.js?v=HOTFIX-20260203-E"></script>
        <script src="js/bazi-system.js?v=HOTFIX-20260203-E"></script>
        <script src="js/fortune-judgment-engine.js?v=HOTFIX-20260203-E"></script>
        <script src="js/quality-mapper.js?v=HOTFIX-20260203-E"></script>
        <script src="js/meihua-system.js?v=HOTFIX-20260203-E"></script>
        <script src="js/nameology-system.js?v=HOTFIX-20260203-E"></script>
        <script src="js/tarot-system.js?v=HOTFIX-20260203-E"></script>
        <script src="logic/tarot_meanings_by_type.js?v=HOTFIX-20260203-E"></script>
        <script src="js/tarot-golden-dawn-system.js?v=HOTFIX-20260203-E"></script>
        <script src="logic/celtic_positions.js?v=HOTFIX-20260203-E"></script>
        <script src="logic/bazi_interpreter.js?v=HOTFIX-20260203-E"></script>
        <script src="logic/meihua_rules.js?v=HOTFIX-20260203-E"></script>
        <script src="logic/crystal_behavior_map.js?v=HOTFIX-20260203-E"></script>
        <script src="logic/fusion_crystal_engine.js?v=HOTFIX-20260203-E"></script>
        <script src="data/crystals_kb.js?v=HOTFIX-20260203-E"></script>
        <script src="data/vendor_inventory.js?v=HOTFIX-20260203-E"></script>
        <script src="js/crystal-evidence-normalizer.js?v=HOTFIX-20260203-E"></script>
        <script src="js/crystal-recommender.js?v=HOTFIX-20260203-E"></script>
        <script src="js/crystal-advice-synthesizer.js?v=HOTFIX-20260203-E"></script>
        <script src="js/crystal-output-guard.js?v=HOTFIX-20260203-E"></script>
        <script src="logic/vocabulary_db.js?v=HOTFIX-20260203-E"></script>
        <script src="logic/time_scope_parser.js?v=HOTFIX-20260203-E"></script>
        <script src="js/question-parser.js?v=HOTFIX-20260203-E"></script>
        <script src="logic/meihua_evidence_data.js?v=HOTFIX-20260203-E"></script>
        <script src="js/evidence-normalizer.js?v=HOTFIX-20260203-E"></script>
        <script src="js/evidence-selector.js?v=HOTFIX-20260203-E"></script>
        <script src="js/answer-synthesizer.js?v=HOTFIX-20260203-E"></script>
        <script src="js/alignment-guard.js?v=HOTFIX-20260203-E"></script>
        <script src="js/explainability-layer.js?v=HOTFIX-20260203-E"></script>
        <script src="js/explainability-guard.js?v=HOTFIX-20260203-E"></script>
        <script src="logic/category_strategy.js?v=HOTFIX-20260203-E"></script>
        <script src="logic/domain_symbol_mapping.js?v=HOTFIX-20260203-E"></script>
        <script src="logic/finance_lottery_mapping.js?v=HOTFIX-20260203-E"></script>
        <script src="js/response-validator.js?v=HOTFIX-20260203-E"></script>
        <script src="engine/fusionEngine.js?v=HOTFIX-20260203-E"></script>
        <script src="js/method-selector.js?v=HOTFIX-20260203-E"></script>
        <script src="js/probability-calculators.js?v=HOTFIX-20260203-E"></script>
        <script src="js/probability-integration.js?v=HOTFIX-20260203-E"></script>
        <script src="js/scoring-engine.js?v=HOTFIX-20260203-E"></script>
        <script src="js/probability-pipeline.js?v=HOTFIX-20260203-E"></script>
        <script src="js/crystal-recommendation.js?v=HOTFIX-20260203-E"></script>
        <script src="js/main.js?v=HOTFIX-20260203-E"></script>
        <script>
            /* 暫時停用 SW，確保改版立即生效；修復完成後可恢復 */
            /* if ('serviceWorker' in navigator) {
                window.addEventListener('load', function() { navigator.serviceWorker.register('./sw.js?v=HOTFIX-20260203-E').catch(function(){}); });
            } */
            if (typeof window !== 'undefined' && window.location && window.location.search.indexOf('test=1') >= 0) {
                (function(){
                    var s = document.createElement('script');
                    s.src = 'tests/qa_alignment_tests.js?v=HOTFIX-20260203-E';
                    s.onload = function(){
                        if (typeof runQAAlignmentTests === 'function') {
                            var res = runQAAlignmentTests();
                            window.qaAlignmentTestResult = res;
                            var block = document.createElement('div');
                            block.id = 'qa-alignment-test-block';
                            block.setAttribute('aria-live', 'polite');
                            block.style.cssText = 'position:fixed;bottom:0;left:0;right:0;background:#1a1520;color:#D4AF37;border-top:2px solid #D4AF37;padding:10px 16px;font-size:14px;max-height:180px;overflow:auto;z-index:9999;';
                            block.innerHTML = '<strong>QA 對齊測試</strong> 通過 ' + (res.passed || 0) + ' / ' + (res.total || 0) + (res.failed ? '　失敗 ' + res.failed + ' 題' : '') +
                                (res.failures && res.failures.length ? '<br>失敗（前5）: ' + res.failures.slice(0, 5).map(function(f){ return f.q + ' → ' + f.reason; }).join(' | ') : '');
                            document.body.appendChild(block);
                        }
                    };
                    document.body.appendChild(s);
                })();
            }
            if (typeof window !== 'undefined' && window.location && window.location.search.indexOf('test=category') >= 0) {
                (function(){
                    var s = document.createElement('script');
                    s.src = 'tests/category_difference_test.js?v=HOTFIX-20260203-E';
                    s.onload = function(){
                        if (typeof runCategoryDifferenceTest === 'function') {
                            var res = runCategoryDifferenceTest();
                            window.categoryDifferenceTestResult = res;
                            console.log('[Category Test] 執行完畢，結果見 categoryDifferenceTestResult');
                        }
                    };
                    document.body.appendChild(s);
                })();
            }
            if (typeof window !== 'undefined' && window.location && window.location.search.indexOf('test=lottery') >= 0) {
                (function(){
                    var s = document.createElement('script');
                    s.src = 'tests/lottery_intent_tests.js?v=HOTFIX-20260203-E';
                    s.onload = function(){
                        if (typeof runLotteryIntentTests === 'function') {
                            var res = runLotteryIntentTests();
                            window.lotteryIntentTestResult = res;
                            console.log('[Lottery Test] 通過 ' + (res.passed || 0) + ' / ' + (res.total || 0), res.failures && res.failures.length ? res.failures : '');
                        }
                    };
                    document.body.appendChild(s);
                })();
            }
            if (typeof window !== 'undefined' && window.location && window.location.search.indexOf('test=intent') >= 0) {
                (function(){
                    var s = document.createElement('script');
                    s.src = 'tests/intent_domain_tests.js?v=HOTFIX-20260203-E';
                    s.onload = function(){
                        if (typeof runIntentDomainTests === 'function') {
                            var res = runIntentDomainTests();
                            window.intentDomainTestResult = res;
                            console.log('[Intent/Domain Test] 通過 ' + (res.passed || 0) + ' / ' + (res.total || 0), res.failures && res.failures.length ? res.failures : '');
                        }
                    };
                    document.body.appendChild(s);
                })();
            }
            if (typeof window !== 'undefined' && window.location && window.location.search.indexOf('test=crystal') >= 0) {
                (function(){
                    var s = document.createElement('script');
                    s.src = 'tests/crystal_recommendation_tests.js?v=HOTFIX-20260203-E';
                    s.onload = function(){
                        if (typeof runCrystalRecommendationTests === 'function') {
                            var res = runCrystalRecommendationTests();
                            window.crystalRecommendationTestResult = res;
                            var block = document.createElement('div');
                            block.id = 'crystal-recommendation-test-block';
                            block.setAttribute('aria-live', 'polite');
                            block.style.cssText = 'position:fixed;bottom:0;left:0;right:0;background:#1a1520;color:#D4AF37;border-top:2px solid #D4AF37;padding:10px 16px;font-size:14px;max-height:180px;overflow:auto;z-index:9999;';
                            block.innerHTML = '<strong>水晶建議測試</strong> 通過 ' + (res.passed || 0) + ' / ' + (res.total || 0) + (res.failed ? '　失敗 ' + res.failed + ' 題' : '') +
                                (res.failures && res.failures.length ? '<br>失敗（前5）: ' + res.failures.slice(0, 5).map(function(f){ return f.q + ' → ' + f.reason; }).join(' | ') : '');
                            document.body.appendChild(block);
                        }
                    };
                    document.body.appendChild(s);
                })();
            }
            if (typeof window !== 'undefined' && window.location && window.location.search.indexOf('test=chenggu') >= 0) {
                (function(){
                    var s = document.createElement('script');
                    s.src = 'tests/chenggu_tests.js?v=HOTFIX-20260203-E';
                    s.onload = function(){
                        if (typeof runChengguTests === 'function') {
                            var res = runChengguTests();
                            window.chengguTestResult = res;
                            console.log('[稱骨測試] 通過 ' + (res.passed || 0) + ' / ' + ((res.passed || 0) + (res.failed || 0)) + (res.failed ? '，失敗 ' + res.failed : ''));
                            if (res.errors && res.errors.length) console.warn('[稱骨測試] 錯誤', res.errors);
                        }
                    };
                    document.body.appendChild(s);
                })();
            }
        </script>
        <script src="js/wizard-controller.js?v=2.0.0"></script>
        <!-- Wizard 初始化由 js/main.js 的 WizardBridge 處理 -->

    </body>
    </html>